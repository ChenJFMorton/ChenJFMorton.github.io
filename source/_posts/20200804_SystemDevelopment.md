---
title: 系统发展涉及点
date: 2020-08-04 10:15:15
hidden: true
categories: 
- Project
---

## 性能

### 目的

- 更低的成本获得更高的价值
  - 服务器成本
  - 用户体验

### 优化原则

- 数据说话
- 遵循演化原则和适度原则
  - 切记过早优化
  - 切记过度优化
- 业务导向二、优化原则
  - 数据说话
  - 遵循演化原则和适度原则
    - 切记过早优化
    - 切记过度优化
  - 业务导向

### 优化思路

- 做的少
- 做得快

### 如何优化

- 存储高性能
  - 缓存
  - 读写分离
  - 分库分表
  - NOSQL
- 计算高性能
  - 集群
    - 横向扩展
  - 单机
    - 硬件
      - 纵向扩展
      - 参数优化
    - 软件
      - 缓存【将数据缓存在离使用者更近的地方】
        - 多级缓存。前端、cdn、分布式缓存、本地缓存
      - 批量操作
      - 异步
        - MQ、线程、队列、排队等
      - 快速失败或者快速成功
      - 预处理
        - 线程池、连接池等
      - 代码优化&参数优化
        - JVM参数、代码细节

### 如何发现

- 哨兵监控
  - 系统级
  - 业务层

### 处理方式

- 没有缓存解决不了的
  - 纵向：扩大容量
  - 横向：按照业务、key等分不同缓存
- 能用MQ就用MQ

## 扩展性

### 基本思想

- 细、远、拆

### 遵循原则

- 适度原则
- 演化原则
- 简单原则

### 业务&需求变化

- 业务扩展性
  - 目标：新增、修改业务功能，快速开发且对老业务影响最小
  - 原则
    - 熟悉业务，预测变化
    - 遵循适度、演化、简单原则
    - 警惕设计过度
- 架构扩展性
  - 服务化：微服务+领域模型
    - 前提：熟悉业务，不然是负债
  - 事件驱动
  - 系统分层
  - docker
- 代码扩展性
  - 兼容性
    - 服务兼容性
    - 接口兼容性
    - 缓存兼容性
      - 数据结构
      - 数据内容
    - 数据兼容性
      - 表结构变更
      - 表数据变更
  - 配置化
  - 插件化
  - 抽象层和实现层隔离
  - 稳定性和变化性隔离
  - 设计模式
- 思维扩展性
  - 加强思维认知

### 服务扩展性

- 无状态原则
- http、dubbo

### 数据扩展性

- 纵向
- 横向
- NOSQL

## 维护性

- 可读性
  - 代码可读性
- 可测性
  - 代码可测性
- 维护性
  - 系统架构维护
  - 系统中模块规范
  - 技术规范
  - 监控规范
  - 文档规范
  - CMS
    - 标准化、流程化、自动化

## 可用性

定义：在能够接受的性能下，持续正确的运行，即使遇到软硬件错误，人为错误

### 硬件

- 原则
  - 冗余方案
- 存储
  - 硬盘：多备份，raid
  - 主备
  - 主从
  - 异地多活
    - 本质：解决数据一致性问题
- 计算
  - 集群

### 软件

- 幂等
  - 业务唯一编号
  - 业务层、数据库（唯一性）同时保证
- 熔断
- 限流
- 容错
  - 中间件
    - redis
      - 熔断
      - 降级
      - 本地缓存
      - 多集群、异地部署
      - 超时配置，异常捕捉
    - dubbo
    - zk
    - mq
  - 业务（原则：尽可能少竞争稀有资源）
    - 默认图片
    - 默认文案
    - 默认业务
    - 默认页面
  - db
    - 主从切换
- 降级
  - 原则：牺牲不重要业务，来提升核心业务性能
- 隔离
  - 原则：保证核心服务
  - 什么是核心业务
    - 产品本质服务
      - 比如微信：聊天，支付宝：支付
    - 赚钱服务
  - 方式
    - 线程池隔离
    - docker
    - 机器、服务隔离
    - 接口隔离
    - 业务隔离
      - 渠道方
      - 调用方
- 并发安全
  - 并发粒度尽量小
  - 并发相关配置
    - 线程池大小
    - 等待时间
    - 等待队列
  - 线程安全
    - 数据错误
- 一致性
  - 数据一致性
- bug
- 监控报警
  - 业务
    - 数据对账
    - 基线波动（正常1000，突然变成1或10000）
  - 系统
- 异常自动恢复
  - 数据重新计算核对、重试
- 快速失败
  - http
  - dubbo
  - 数据库连接
  - 中间件超时时间配置
- 事务
  - 粒度尽量小
  - 禁止远程调用
- 测试
  - 单元测试
  - 性能测试
  - 安全测试
  - 全链路压测
- 异常重试
  - 防止雪崩，重试次数限制

## 安全性

### 硬件

- ddos
- 防火墙
  - 端口
- nginx
  - ip限制
  - url限制
- http+https

### 漏洞

- 框架漏洞
- 系统漏铜

### 业务

- 权限控制
  - 登录
  - 白名单
  - 黑名单
- 伪造
  - 第三方接口签名验证
- 数据校验
  - 技术校验
    - 长度、空值、分页限制
  - 业务校验
    - 比如：订单ID为传入参数进行支付，那通过订单ID查到的下单人和当前登入用户应该保持一致
- 风控校验
  - 比如：单日提现不超过500.下单每日不超过5次
- 幂等性
- 流程审核
  - 比如，A发起审核，B进行确认，再C确认
- 反编译
  - 客户端
  - 前端

### 数据

- 传输（框架解决）
  - sql注入
  - XSS防御
- 存储（log\db\es）
  - 敏感信息加密保存
- 展示(身份证等敏感信息)
  - 订单ID
  - 身份证信息
  - 手机号信息

### 人

- 重要信息泄露
  - 代码、地址等上传到外部
  - 配置文件密码等放在代码中
- 删库等人为操作