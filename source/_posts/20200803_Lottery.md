---
title: 抽奖的一种实现方式
date: 2020-08-03 15:15:15
hidden: true
categories: 
- Project
---

## 需求

某个时间段内，对应奖品类别发放特定数量。

## 方案

假如 10个奖品A，100个奖品B，1000个奖品C，在8点到16点时间内分发完，在8-16点时间按秒随机1110个不同时间点的数据，按从早到晚排序到中奖时间队列中，当某个用户参与中奖，如果中奖队列存在比当前时间早的，依次中奖，并按照剩余奖品类别个数依次做区间划分，如刚开始是1-10-110-1110，从1110随机取整数定位奖品编号。

应用redis SortedSet有序集合类型，

**ZADD key score member**

score：时间戳，member:对应的奖品编号

```
ZRANGE key start stop [WITHSCORES] 取第一位最小时间戳和当前抽奖时间比较，如果存在比当前时间小的数据，就代表有奖可领，对应的去做ZREM key member 操作，如果返回1，说明中奖成功，将对应的奖品
```

编号更新到数据库。

![](https://pic.downk.cc/item/5f27c03814195aa594e094aa.png)